# iOS Build Setup Guide

## Prerequisites

- **Apple Developer Account** ($99/year) - Required for device testing and App Store
- **EAS CLI** installed (`npm install -g eas-cli`)
- **Mac computer** (optional - EAS can build in the cloud)

## Step 1: Configure iOS in app.json

Your current iOS configuration:
```json
"ios": {
  "supportsTablet": true,
  "bundleIdentifier": "com.flowfocus.app",
  "infoPlist": {
    "ITSAppUsesNonExemptEncryption": false,
    "UIBackgroundModes": ["audio"],
    "NSMicrophoneUsageDescription": "This app uses audio for focus sessions and ambient sounds.",
    "NSCameraUsageDescription": "This app may use camera for profile pictures."
  }
}
```

✅ Already configured!

## Step 2: Initialize EAS Project

```bash
# Initialize EAS (will prompt for Apple account)
eas init

# This will:
# - Create EAS project ID
# - Add it to app.json
# - Link to your Expo account
```

## Step 3: Configure Apple Credentials

EAS can manage iOS credentials automatically:

```bash
# Let EAS handle credentials automatically
eas build --profile development --platform ios

# Or manage manually:
eas credentials
```

**What EAS will create/manage:**
- Development Provisioning Profile
- Development Certificate
- Push Notification keys (if needed)
- Distribution certificates (for production)

## Step 4: Build Development Client

```bash
# Build for iOS development
eas build --profile development --platform ios

# EAS will:
# 1. Ask for Apple ID (if not configured)
# 2. Generate/reuse certificates
# 3. Build in cloud (~15-20 minutes)
# 4. Give you a download link
```

## Step 5: Install on iOS Device

### Option A: Download directly on device
1. Open the link from EAS on your iPhone
2. Download and install the `.ipa` file
3. Trust the developer certificate in Settings > General > VPN & Device Management

### Option B: Install via TestFlight (Production builds)
```bash
# Build for TestFlight
eas build --profile preview --platform ios

# Submit to TestFlight
eas submit --platform ios
```

### Option C: Install via Mac
1. Download `.ipa` from EAS
2. Connect iPhone to Mac
3. Open **Xcode** > **Window** > **Devices and Simulators**
4. Drag the `.ipa` onto your device

## Step 6: Start Development

Once the development client is installed:

```bash
# Start Expo dev server
npm start

# Your custom app will detect the dev server and load
# Hot reloading works just like Expo Go!
```

## Google OAuth for iOS

### Get iOS Client ID

1. Go to [Google Cloud Console](https://console.cloud.google.com/apis/credentials)
2. Create **OAuth 2.0 Client ID**
3. Select **iOS**
4. Enter bundle ID: `com.flowfocus.app`
5. Copy the **iOS Client ID**

### Configure URL Scheme

The iOS URL scheme is automatically generated by Google. It looks like:
```
com.googleusercontent.apps.123456789-abc123xyz
```

Update `app.json`:
```json
"plugins": [
  [
    "@react-native-google-signin/google-signin",
    {
      "iosUrlScheme": "com.googleusercontent.apps.YOUR-IOS-CLIENT-ID"
    }
  ]
]
```

### Update .env

```bash
EXPO_PUBLIC_GOOGLE_IOS_CLIENT_ID=YOUR-IOS-CLIENT-ID.apps.googleusercontent.com
EXPO_PUBLIC_GOOGLE_WEB_CLIENT_ID=YOUR-WEB-CLIENT-ID.apps.googleusercontent.com
```

**Important:** You need BOTH iOS and Web Client IDs for Supabase + Google Sign-in to work!

## Troubleshooting

### "Unable to install app"
- Trust the developer certificate: Settings > General > VPN & Device Management
- Check device is registered in Apple Developer Portal

### "Google Sign-in not working"
- Verify bundle identifier matches: `com.flowfocus.app`
- Check iOS URL scheme in app.json matches Google Console
- Wait 5-10 minutes for Google to propagate changes
- Ensure both Web and iOS Client IDs are configured

### "Provisioning profile error"
```bash
# Reset credentials and try again
eas credentials --platform ios
# Select "Remove credentials"
# Then rebuild
```

### "Build failed: Missing capabilities"
- EAS will prompt for any required capabilities
- Follow the prompts to configure

## Cost & Time

- **First build:** ~20-30 minutes (credential setup)
- **Subsequent builds:** ~15-20 minutes
- **Apple Developer:** $99/year (required for device testing)
- **EAS builds:** Free tier includes limited builds/month, paid plans available

## Quick Reference Commands

```bash
# Initialize project
eas init

# Build development client
eas build --profile development --platform ios

# Build for TestFlight
eas build --profile preview --platform ios

# Build for App Store
eas build --profile production --platform ios

# Submit to App Store
eas submit --platform ios

# Check build status
eas build:list

# View/manage credentials
eas credentials --platform ios
```

## Next Steps

After your first successful build:

1. ✅ Install development client on iPhone
2. ✅ Run `npm start`
3. ✅ Open the Flow Focus app on your device
4. ✅ Test Google Sign-in
5. ✅ Develop with hot reloading!

